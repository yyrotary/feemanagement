# í”„ë¡œì íŠ¸ ë¬¸ì„œí™”

## ğŸ¯ ë¹„ì¦ˆë‹ˆìŠ¤ ìš”êµ¬ì‚¬í•­

### í•µì‹¬ ëª©í‘œ
- ì˜ì–‘ ë¡œíƒ€ë¦¬í´ëŸ½ íšŒì›ë“¤ì˜ íšŒë¹„ ê´€ë¦¬ íš¨ìœ¨í™”
- íˆ¬ëª…í•œ íšŒë¹„ í˜„í™© ê³µìœ 
- ê´€ë¦¬ìì˜ ì—…ë¬´ ë¶€ë‹´ ê²½ê°
- ìë™í™”ë¥¼ í†µí•œ ì •í™•ì„± í–¥ìƒ

### ì‚¬ìš©ì ìŠ¤í† ë¦¬

#### íšŒì› (ì¼ë°˜ ì‚¬ìš©ì)
```
As a ë¡œíƒ€ë¦¬í´ëŸ½ íšŒì›
I want to ë‚´ íšŒë¹„ í˜„í™©ì„ ì‰½ê²Œ ì¡°íšŒí•˜ê³  ì‹¶ë‹¤
So that ë‚©ë¶€ ìƒí™©ì„ ì •í™•íˆ íŒŒì•…í•  ìˆ˜ ìˆë‹¤
```

#### ê´€ë¦¬ì (ì¬ë¬´ë‹´ë‹¹ì)
```
As a ì¬ë¬´ë‹´ë‹¹ì
I want to íšŒë¹„ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬í•˜ê³  ì‹¶ë‹¤
So that ì •í™•í•œ íšŒê³„ ì²˜ë¦¬ê°€ ê°€ëŠ¥í•˜ë‹¤
```

## ğŸ— ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

### High-Level Architecture
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Frontend      â”‚    â”‚   Backend       â”‚    â”‚   External      â”‚
â”‚   (Next.js)     â”‚â—„â”€â”€â–ºâ”‚   (API Routes)  â”‚â—„â”€â”€â–ºâ”‚   (Notion API)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–²                        â–²                        â–²
         â”‚                        â”‚                        â”‚
         â–¼                        â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   UI Components â”‚    â”‚   Business      â”‚    â”‚   Gmail API     â”‚
â”‚   CSS Modules   â”‚    â”‚   Logic         â”‚    â”‚   (Auto Sync)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Data Flow Diagram
```
ì‚¬ìš©ì ì…ë ¥ (ì „í™”ë²ˆí˜¸) 
    â†“
ì…ë ¥ ê²€ì¦ ë° í¬ë§·íŒ…
    â†“
Notion API í˜¸ì¶œ (íšŒì› ì¡°íšŒ)
    â†“
ê´€ë ¨ íšŒë¹„ ë°ì´í„° ìˆ˜ì§‘
    â†“
ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì ìš© (ê³„ì‚°)
    â†“
ì‘ë‹µ ë°ì´í„° êµ¬ì„±
    â†“
UI ë Œë”ë§
```

## ğŸ“Š ë°ì´í„° ëª¨ë¸

### íšŒì› (Members)
```typescript
interface Member {
  id: string;           // Notion Page ID
  name: string;         // íšŒì› ì´ë¦„
  nickname?: string;    // ë³„ëª…
  phone: number;        // ì „í™”ë²ˆí˜¸ ë’· 4ìë¦¬
  deduction: string[];  // í• ì¸ ìœ í˜• (senior ë“±)
}
```

### íšŒë¹„ (Fees)
```typescript
interface Fee {
  id: string;           // Notion Page ID
  member: string;       // Member ID (Relation)
  date: string;         // ë‚©ë¶€ ë‚ ì§œ
  paid_fee: number;     // ë‚©ë¶€ ê¸ˆì•¡
  method: string[];     // ë‚©ë¶€ ë°©ë²• (cash, card, deposit)
}
```

### íŠ¹ë³„íšŒë¹„ (Special Fees)
```typescript
interface SpecialFee {
  id: string;           // Notion Page ID
  member: string;       // Member ID (Relation)
  date: string;         // ë‚©ë¶€ ë‚ ì§œ
  amount: number;       // ë‚©ë¶€ ê¸ˆì•¡
  method: string[];     // ë‚©ë¶€ ë°©ë²•
}
```

### íŠ¹ë³„ ì´ë²¤íŠ¸ (Special Events)
```typescript
interface SpecialEvent {
  id: string;           // Notion Page ID
  date: string;         // ì´ë²¤íŠ¸ ë‚ ì§œ
  name: string;         // ëŒ€ìƒì ì´ë¦„
  nickname?: string;    // ëŒ€ìƒì ë³„ëª…
  events: string;       // ì´ë²¤íŠ¸ ìœ í˜• (ê²°í˜¼, ì¥ë¡€ ë“±)
}
```

## ğŸ”§ API ëª…ì„¸ì„œ

### 1. íšŒì› íšŒë¹„ ì¡°íšŒ
```http
POST /api/getMemberFees
Content-Type: application/json

{
  "phone": "1234"
}
```

**Response:**
```json
{
  "id": "notion-page-id",
  "name": "í™ê¸¸ë™",
  "nickname": "ê¸¸ë™ì´",
  "totalPaid": 720000,
  "remainingFee": 0,
  "feeHistory": [
    {
      "date": "2024-01-15",
      "paid_fee": 360000,
      "method": ["deposit"]
    }
  ]
}
```

### 2. íŠ¹ë³„íšŒë¹„ ê³„ì‚°
```http
GET /api/calculateSpecialFee?memberName=í™ê¸¸ë™
```

**Response:**
```json
{
  "totalFee": 100000,
  "specialEventFee": 20000,
  "events": [
    {
      "id": "event-id",
      "date": "2024-01-01",
      "name": "ê¹€ì² ìˆ˜",
      "events": "ê²°í˜¼"
    }
  ]
}
```

### 3. ê´€ë¦¬ì ì¸ì¦
```http
POST /api/verifyAdmin
Content-Type: application/json

{
  "password": "admin-password"
}
```

**Response:**
```json
{
  "success": true
}
```

### 4. íšŒë¹„ ì¶”ê°€
```http
POST /api/addFee
Content-Type: application/json

{
  "memberId": "notion-page-id",
  "amount": 360000,
  "date": "2024-01-15",
  "method": ["deposit"]
}
```

## ğŸ¨ UI/UX ì„¤ê³„

### Design System

#### Color Palette
```css
:root {
  --primary-blue: #1f4788;      /* ë¡œíƒ€ë¦¬ ë¸”ë£¨ */
  --accent-gold: #f7931e;       /* ë¡œíƒ€ë¦¬ ê³¨ë“œ */
  --success-green: #28a745;     /* ì„±ê³µ */
  --warning-orange: #ffc107;    /* ê²½ê³  */
  --error-red: #dc3545;         /* ì˜¤ë¥˜ */
  --text-dark: #333333;         /* ê¸°ë³¸ í…ìŠ¤íŠ¸ */
  --text-light: #666666;        /* ë³´ì¡° í…ìŠ¤íŠ¸ */
  --background: #ffffff;        /* ë°°ê²½ */
  --border: #e9ecef;           /* í…Œë‘ë¦¬ */
}
```

#### Typography
```css
.title {
  font-size: 2.5rem;
  font-weight: 700;
  color: var(--primary-blue);
}

.subtitle {
  font-size: 1.5rem;
  font-weight: 600;
  color: var(--text-dark);
}

.body {
  font-size: 1rem;
  font-weight: 400;
  color: var(--text-dark);
}

.caption {
  font-size: 0.875rem;
  font-weight: 400;
  color: var(--text-light);
}
```

### Component Library

#### Button
```tsx
interface ButtonProps {
  variant: 'primary' | 'secondary' | 'danger';
  size: 'small' | 'medium' | 'large';
  disabled?: boolean;
  loading?: boolean;
  children: React.ReactNode;
  onClick?: () => void;
}
```

#### Input
```tsx
interface InputProps {
  type: 'text' | 'number' | 'email' | 'password';
  placeholder?: string;
  value: string;
  onChange: (value: string) => void;
  maxLength?: number;
  pattern?: string;
  required?: boolean;
  error?: string;
}
```

#### Table
```tsx
interface TableProps {
  headers: string[];
  data: any[][];
  sortable?: boolean;
  pagination?: boolean;
}
```

## ğŸ”’ ë³´ì•ˆ ì„¤ê³„

### Authentication
- **ê´€ë¦¬ì ì¸ì¦**: ë¹„ë°€ë²ˆí˜¸ ê¸°ë°˜ (í–¥í›„ JWT í† í°ìœ¼ë¡œ ê°œì„  ì˜ˆì •)
- **ì„¸ì…˜ ê´€ë¦¬**: NextAuth.js í™œìš© (êµ¬í˜„ ì¤€ë¹„ ì¤‘)

### Authorization
- **ê³µê°œ ì ‘ê·¼**: íšŒë¹„ ì¡°íšŒ ê¸°ëŠ¥
- **ê´€ë¦¬ì ì „ìš©**: íšŒë¹„ ê´€ë¦¬, ëŒ€ì‹œë³´ë“œ, ì„¤ì •

### Data Protection
- **ì…ë ¥ ê²€ì¦**: í´ë¼ì´ì–¸íŠ¸/ì„œë²„ ì–‘ì¸¡ ê²€ì¦
- **SQL Injection ë°©ì§€**: Notion API ì‚¬ìš©ìœ¼ë¡œ ìì—°ìŠ¤ëŸ½ê²Œ ë°©ì§€
- **XSS ë°©ì§€**: Reactì˜ ê¸°ë³¸ XSS ë³´í˜¸ í™œìš©

### API Security
```typescript
// API ë¼ìš°íŠ¸ ë³´í˜¸ íŒ¨í„´
export async function POST(request: Request) {
  try {
    // 1. ì…ë ¥ ê²€ì¦
    const { phone } = await request.json();
    if (!phone || phone.length !== 4) {
      return NextResponse.json({ error: 'ì˜¬ë°”ë¥¸ ì „í™”ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.' }, { status: 400 });
    }

    // 2. ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
    // ...

    // 3. ì•ˆì „í•œ ì‘ë‹µ
    return NextResponse.json(data);
  } catch (error) {
    // 4. ì—ëŸ¬ ì²˜ë¦¬ (ë¯¼ê° ì •ë³´ ë…¸ì¶œ ë°©ì§€)
    return NextResponse.json({ error: 'ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.' }, { status: 500 });
  }
}
```

## ğŸš€ ë°°í¬ ë° DevOps

### Deployment Pipeline
```mermaid
graph LR
    A[Local Development] --> B[Git Push]
    B --> C[Vercel Build]
    C --> D[Automated Tests]
    D --> E[Production Deploy]
    E --> F[Health Check]
```

### Environment Configuration
```bash
# Development
NODE_ENV=development
NOTION_API_KEY=your-dev-key

# Production
NODE_ENV=production
NOTION_API_KEY=your-prod-key
```

### Monitoring
- **ì—ëŸ¬ ì¶”ì **: Console.error ë¡œê¹…
- **ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§**: Vercel Analytics
- **ì‚¬ìš©ì ë¶„ì„**: ê¸°ë³¸ ì ‘ì† ë¡œê·¸

## ğŸ“ˆ ì„±ëŠ¥ ìµœì í™”

### Frontend Optimization
```typescript
// 1. ì½”ë“œ ë¶„í• 
const AdminDashboard = dynamic(() => import('./components/AdminDashboard'), {
  loading: () => <p>Loading...</p>,
});

// 2. ì´ë¯¸ì§€ ìµœì í™”
import Image from 'next/image';
<Image 
  src="/rotary-logo.png"
  alt="ë¡œê³ "
  width={400}
  height={400}
  priority
/>

// 3. ë©”ëª¨ì´ì œì´ì…˜
const MemberList = memo(({ members }) => {
  // ì»´í¬ë„ŒíŠ¸ ë¡œì§
});
```

### Backend Optimization
```typescript
// 1. API ì‘ë‹µ ìºì‹±
export async function GET(request: Request) {
  const data = await getCachedData();
  return NextResponse.json(data, {
    headers: {
      'Cache-Control': 'public, s-maxage=60'
    }
  });
}

// 2. ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬ ìµœì í™”
const memberResponse = await notionClient.databases.query({
  database_id: DATABASE_IDS.MEMBERS,
  filter: {
    property: 'phone',
    number: { equals: Number(phone) }
  },
  page_size: 1 // í•„ìš”í•œ ë§Œí¼ë§Œ ì¡°íšŒ
});
```

## ğŸ§ª í…ŒìŠ¤íŠ¸ ì „ëµ

### Testing Pyramid
```
                /\
               /  \
              / E2E \
             /______\
            /        \
           /Integration\
          /____________\
         /              \
        /   Unit Tests   \
       /________________\
```

### Unit Tests (ê³„íš)
```typescript
// ì˜ˆì‹œ: ì „í™”ë²ˆí˜¸ ê²€ì¦ í…ŒìŠ¤íŠ¸
describe('Phone validation', () => {
  test('should accept 4-digit phone number', () => {
    expect(validatePhone('1234')).toBe(true);
  });

  test('should reject non-4-digit phone number', () => {
    expect(validatePhone('123')).toBe(false);
    expect(validatePhone('12345')).toBe(false);
  });
});
```

### Integration Tests (ê³„íš)
```typescript
// ì˜ˆì‹œ: API í…ŒìŠ¤íŠ¸
describe('/api/getMemberFees', () => {
  test('should return member data for valid phone', async () => {
    const response = await fetch('/api/getMemberFees', {
      method: 'POST',
      body: JSON.stringify({ phone: '1234' })
    });
    
    expect(response.status).toBe(200);
    const data = await response.json();
    expect(data).toHaveProperty('name');
  });
});
```

## ğŸ“š ì°¸ê³  ë¬¸ì„œ

### External APIs
- [Notion API Documentation](https://developers.notion.com/)
- [Gmail API Documentation](https://developers.google.com/gmail/api)
- [Next.js Documentation](https://nextjs.org/docs)

### Internal Documentation
- `README.md`: í”„ë¡œì íŠ¸ ê°œìš” ë° ì„¤ì •
- `WORK_LOG.md`: ì‘ì—… ê¸°ë¡ ë° ë¶„ì„
- `CRON-SETUP.md`: ìë™í™” ì„¤ì • (ìˆ˜ì • í•„ìš”)

### Code Documentation
```typescript
/**
 * íšŒì›ì˜ íšŒë¹„ ì •ë³´ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤.
 * @param phone - ì „í™”ë²ˆí˜¸ ë’· 4ìë¦¬
 * @returns Promise<MemberData> - íšŒì› ì •ë³´ ë° íšŒë¹„ í˜„í™©
 * @throws {Error} íšŒì›ì„ ì°¾ì„ ìˆ˜ ì—†ëŠ” ê²½ìš°
 */
export async function getMemberFees(phone: string): Promise<MemberData> {
  // êµ¬í˜„ ë¡œì§
}
```

---

**ë¬¸ì„œ ë²„ì „**: v1.0  
**ìµœì¢… ì—…ë°ì´íŠ¸**: 2025ë…„ 7ì›” 3ì¼  
**ë‹´ë‹¹ì**: Development Team  
**ê²€í† ì**: Project Manager
